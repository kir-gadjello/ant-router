# ==================================================================================
# Unified Model Configuration Protocol (UMCP) v1.0 - Default Configuration
# ==================================================================================
#
# This configuration file defines the server behavior, upstream provider settings,
# and model definitions. It supports inheritance, deep merging, and intelligent routing.
#
# USAGE:
#   This file is loaded by default from `./config.yaml` or `$HOME/.ant-router/config.yaml`.
#   You can override values using environment variables.
#
# ==================================================================================

# ----------------------------------------------------------------------------------
# Server Configuration
# ----------------------------------------------------------------------------------
server:
  host: "127.0.0.1"
  port: 3000

# ----------------------------------------------------------------------------------
# Logging Configuration
# ----------------------------------------------------------------------------------
log_enabled: true
# log_file: "./requests.jsonl"

# ----------------------------------------------------------------------------------
# Security Flags
# ----------------------------------------------------------------------------------
# If true, explicitly forbids any request where the wire model ID contains "anthropic".
no_ant: false

# ----------------------------------------------------------------------------------
# Default Upstream Configuration
# ----------------------------------------------------------------------------------
upstream:
  base_url: "https://openrouter.ai/api"
  api_key_env_var: "OPENROUTER_API_KEY"

# ----------------------------------------------------------------------------------
# Current Profile (Routing)
# ----------------------------------------------------------------------------------
# The active profile that defines how requests are routed to logical models.
current_profile: "stepfun"

# ----------------------------------------------------------------------------------
# Model Definitions (UMCP)
# ----------------------------------------------------------------------------------
# Define logical models with capabilities, context limits, and upstream parameters.
# Profiles map request patterns to these Keys.
models:

  # --- Base Templates ---
  _base_openrouter:
    provider: openrouter
    api_params:
      # extra_body:
      #   stream_options:
      #     include_usage: true
      retry:
        max_retries: 3
        backoff_ms: 500

  # --- Concrete Models ---

  # Stepfun Models
  "stepfun-flash":
    extends: _base_openrouter
    api_model_id: "stepfun/step-3.5-flash:free"
    aliases: ["step-3.5-flash"]
    
    # Force reasoning: ensures reasoning is enabled with a specific effort level.
    # Supported values: true (default low), false (none), "low", "medium", "high", or integer (token budget).
    force_reasoning: high
    #override_max_tokens: auto

    capabilities:
      reasoning: true
      max_output_tokens: 256k
      max_context_tokens: 256k

    # Preprocessing options to fix upstream compatibility issues
    preprocess:
      # Merges multiple system messages into one (needed for some providers)
      merge_system_messages: true
      # Filters out tool calls with empty names and deduplicates tool IDs
      # sanitize_tool_history: true
      # Caps the maximum output tokens to a safe limit (or use "auto" to unset it)
      # max_output_tokens: "auto"

  # Vision Models (Z-AI GLM)
  "glm-4d6-v":
    extends: _base_openrouter
    api_model_id: "z-ai/glm-4.6v"
    capabilities:
      vision: true
      reasoning: true

  # Grok 4.1 Fast (Example of Min Reasoning)
  "grok41fast":
    extends: _base_openrouter
    api_model_id: "x-ai/grok-4.1-fast"
    aliases: ["grok-4.1-fast"]
    
    # Min Reasoning: ensures reasoning is enabled if client doesn't request it.
    # If client requests budget < min, it upgrades it.
    min_reasoning: true
    
    capabilities:
      vision: true
      reasoning: true

# ----------------------------------------------------------------------------------
# Profiles
# ----------------------------------------------------------------------------------
# Profiles define mapping rules.
# - pattern: Regex/Glob to match input model ID.
# - match_features: List of required features in request (vision, reasoning)
# - target: Key in `models` map (Logical Model ID).

profiles:
  # Profile: Stepfun Flash (Free) with GLM vision fallback
  stepfun:
    rules:
      # If request needs vision, route to GLM
      - pattern: ".*"
        match_features: ["vision"]
        target: "glm-4d6-v"

      # Default catch-all
      - pattern: ".*"
        target: "stepfun-flash"

  # Profile: Grok 4.1 Fast
  grok41fast:
    rules:
      - pattern: ".*"
        target: "grok41fast"